# Neuroline Monorepo

[![Demo](https://img.shields.io/badge/Demo-neuroline.vercel.app-blue)](https://neuroline.vercel.app/)
[![GitHub](https://img.shields.io/badge/GitHub-sergeychernov/neuroline-black)](https://github.com/sergeychernov/neuroline)

ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ¿Ğ°ĞºĞµÑ‚Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ pipeline.

## ğŸ“¦ ĞŸĞ°ĞºĞµÑ‚Ñ‹

| ĞŸĞ°ĞºĞµÑ‚ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-------|----------|
| `neuroline` | Ğ¤Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº-Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ğº Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ´Ğ»Ñ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ pipeline |
| `neuroline-ui` | React ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ pipeline |
| `neuroline-nextjs` | Ğ¥ĞµĞ»Ğ¿ĞµÑ€Ñ‹ Ğ´Ğ»Ñ Next.js App Router |
| `neuroline-nestjs` | ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¸ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ Ğ´Ğ»Ñ NestJS |

## ğŸš€ ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

| ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------------|----------|
| `@neuroline/nextjs` | Ğ”ĞµĞ¼Ğ¾ Next.js Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹ |
| `@neuroline/nestjs-example` | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ±ĞµĞºĞµĞ½Ğ´Ğ° Ğ½Ğ° NestJS |

## ğŸ§  ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ

Pipeline â€” ÑÑ‚Ğ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ **stages**, ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¸Ğ· ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ»Ğ¸ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ **jobs**.
Jobs Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ stage Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾, Ğ° stages â€” Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾.

ĞšĞ°Ğ¶Ğ´Ğ°Ñ Job Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ° Ğ½Ğ° **Ğ½ĞµĞ¹Ñ€Ğ¾Ğ½**:
- ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ñ… jobs Ğ¸Ğ»Ğ¸ input pipeline)
- ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ñ… (execute Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ)
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ (Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚) Ğ´Ğ»Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ñ… jobs

```
Pipeline
â”œâ”€â”€ Stage 1: [fetch-data]              â† Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
â”œâ”€â”€ Stage 2: [validate, notify-start]  â† Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾
â”œâ”€â”€ Stage 3: [transform-data]          â† Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
â”œâ”€â”€ Stage 4: [save-to-db, update-cache]â† Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾
â””â”€â”€ Stage 5: [notify-complete]         â† Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
```

## ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

```bash
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
yarn install

# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ²ÑĞµÑ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²
yarn build:packages

# Ğ—Ğ°Ğ¿ÑƒÑĞº Next.js Ğ´ĞµĞ¼Ğ¾ (Ğ¿Ğ¾Ñ€Ñ‚ 3000)
yarn dev

# Ğ—Ğ°Ğ¿ÑƒÑĞº NestJS Ğ±ĞµĞºĞµĞ½Ğ´Ğ° (Ğ¿Ğ¾Ñ€Ñ‚ 3003)
yarn dev:nestjs

# Ğ—Ğ°Ğ¿ÑƒÑĞº Storybook (Ğ¿Ğ¾Ñ€Ñ‚ 6006)
yarn storybook
```

## ğŸ“¡ API Endpoints

ĞĞ±Ğ° Ñ…ĞµĞ»Ğ¿ĞµÑ€Ğ° (`neuroline-nextjs` Ğ¸ `neuroline-nestjs`) Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‚ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¹ API:

### POST /pipeline - Ğ—Ğ°Ğ¿ÑƒÑĞº pipeline

```bash
curl -X POST http://localhost:3003/pipeline \
  -H "Content-Type: application/json" \
  -d '{
    "pipelineType": "demo-pipeline",
    "input": { "url": "https://api.example.com/data" }
  }'
```

### GET /pipeline/status?id=xxx - Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ

```bash
curl "http://localhost:3003/pipeline/status?id=abc123"
```

### GET /pipeline/result?id=xxx - Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹

```bash
curl "http://localhost:3003/pipeline/result?id=abc123"
```

### GET /pipeline/list?page=1&limit=10 - Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸ĞµĞ¹

```bash
curl "http://localhost:3003/pipeline/list?page=1&limit=10"
```

## ğŸ”§ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Next.js (App Router)

```typescript
// app/api/pipeline/route.ts
import { createPipelineRouteHandler } from 'neuroline-nextjs';
import { PipelineManager, InMemoryPipelineStorage } from 'neuroline';
import { myPipeline } from '@/pipelines';

const storage = new InMemoryPipelineStorage();
const manager = new PipelineManager({ storage });

const handlers = createPipelineRouteHandler({
  manager,
  storage,
  pipelines: [myPipeline],
});

// GET /api/pipeline?action=status&id=xxx
// GET /api/pipeline?action=result&id=xxx
// GET /api/pipeline?action=list&page=1&limit=10
export const GET = handlers.GET;

// POST /api/pipeline
export const POST = handlers.POST;
```

### NestJS

```typescript
// app.module.ts
import { Module } from '@nestjs/common';
import { PipelineManager, InMemoryPipelineStorage } from 'neuroline';
import { NeurolineModule } from 'neuroline-nestjs';
import { myPipeline } from './pipelines';

const storage = new InMemoryPipelineStorage();
const manager = new PipelineManager({ storage });

@Module({
  imports: [
    NeurolineModule.register({
      manager,
      storage,
      pipelines: [myPipeline],
    }),
  ],
})
export class AppModule {}
```

Endpoints Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
- `POST /pipeline` - Ğ·Ğ°Ğ¿ÑƒÑĞº
- `GET /pipeline/status?id=xxx` - ÑÑ‚Ğ°Ñ‚ÑƒÑ
- `GET /pipeline/result?id=xxx` - Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
- `GET /pipeline/list?page=1&limit=10` - ÑĞ¿Ğ¸ÑĞ¾Ğº

### NestJS Ñ MongoDB

```typescript
import { Module } from '@nestjs/common';
import { MongooseModule, getModelToken } from '@nestjs/mongoose';
import { PipelineManager, MongoPipelineStorage, PipelineSchema } from 'neuroline';
import { NeurolineModule } from 'neuroline-nestjs';

@Module({
  imports: [
    MongooseModule.forRoot('mongodb://localhost:27017/neuroline'),
    MongooseModule.forFeature([{ name: 'Pipeline', schema: PipelineSchema }]),
    NeurolineModule.registerAsync({
      imports: [MongooseModule],
      useFactory: (pipelineModel) => {
        const storage = new MongoPipelineStorage(pipelineModel);
        const manager = new PipelineManager({ storage });
        return { manager, storage, pipelines: [myPipeline] };
      },
      inject: [getModelToken('Pipeline')],
    }),
  ],
})
export class AppModule {}
```

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
neuroline/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ neuroline/           # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ manager.ts   # PipelineManager
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.ts   # InMemoryStorage
â”‚   â”‚   â”‚   â”œâ”€â”€ mongo-storage.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ neuroline-ui/        # UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PipelineViewer.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ JobNode.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ neuroline-nextjs/    # Next.js Ñ…ĞµĞ»Ğ¿ĞµÑ€Ñ‹
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ route-handler.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ neuroline-nestjs/    # NestJS Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ neuroline.module.ts
â”‚       â”‚   â”œâ”€â”€ neuroline.controller.ts
â”‚       â”‚   â”œâ”€â”€ neuroline.service.ts
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ nextjs/              # Next.js Ğ´ĞµĞ¼Ğ¾
â”‚   â”‚   â””â”€â”€ src/app/
â”‚   â”‚
â”‚   â””â”€â”€ nestjs/              # NestJS Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ main.ts
â”‚       â”‚   â”œâ”€â”€ app.module.ts
â”‚       â”‚   â””â”€â”€ pipelines/
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸš¢ Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹

### Vercel (Next.js)

Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Ğ½Ğ° Vercel Ğ¿Ñ€Ğ¸ Ğ¿ÑƒÑˆĞµ Ğ² `main`.

### Docker (NestJS)

```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY . .
RUN yarn install && yarn build:packages
WORKDIR /app/apps/nestjs
RUN yarn build
CMD ["yarn", "start:prod"]
```

## ğŸ“š Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

- [neuroline](packages/neuroline/README.md) - Pipeline Manager
- [neuroline-nestjs](apps/nestjs/README.md) - NestJS Example

## ğŸ“ Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ

UNLICENSED
