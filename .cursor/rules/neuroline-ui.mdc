---
description: Правила для пакета neuroline-ui
globs: packages/neuroline-ui/**/*
---

# Пакет: neuroline-ui

## Назначение

React компоненты для визуализации pipelines: статусы, графы, прогресс.

## Стек

- React 18 (функциональные компоненты)
- MUI 5 (Material UI)
- Storybook 10 для разработки

## Структура

```
src/
├── index.ts              # Публичные экспорты
├── types.ts              # Типы для компонентов
├── theme.ts              # MUI тема / цвета
└── components/
    ├── PipelineViewer.tsx
    ├── PipelineViewer.stories.tsx
    ├── JobNode.tsx
    ├── JobNode.stories.tsx
    ├── StageColumn.tsx
    ├── StatusBadge.tsx
    └── job-details/
        ├── JobDetailsPanel.tsx
        ├── JobDetailsPanel.stories.tsx
        ├── ArtifactView.tsx
        ├── InputView.tsx
        ├── OptionsView.tsx
        └── ErrorView.tsx
```

## Соглашения React

- **Функциональные компоненты** с хуками
- **Props interface** с суффиксом `Props`: `PipelineViewerProps`
- **Деструктуризация props** в параметрах
- **Мемоизация** через `useMemo`/`useCallback` для тяжёлых вычислений

## Компоненты

### PipelineViewer

Основной компонент визуализации pipeline:

```tsx
<PipelineViewer
    pipeline={pipeline}
    selectedJobName={selectedJob?.name}
    onJobClick={(job) => console.log(job)}
/>
```

Примечание:
- `PipelineViewer` **не управляет внешним состоянием** и отображает только то, что пришло в `pipeline`.
- Артефакты и подробности job рекомендуется показывать в `JobDetailsPanel` (по клику на job, после отдельного запроса в API).

### JobNode и Retry

`JobNode` отображает кнопку retry с возможностью перезапуска:

```tsx
<JobNode
    job={job}
    onClick={(job) => console.log('clicked', job)}
    onRetry={(job) => restartPipeline(job.name)}  // callback для перезапуска
/>
```

```typescript
interface JobNodeProps {
    job: JobDisplayInfo;
    isSelected?: boolean;
    onClick?: (job: JobDisplayInfo) => void;
    onRetry?: (job: JobDisplayInfo) => void;  // callback при клике на кнопку retry
}

interface JobDisplayInfo {
    // ... другие поля
    retryCount?: number;   // Количество выполненных ретраев
    maxRetries?: number;   // Максимальное количество ретраев
}
```

- Кнопка retry видна если передан `onRetry` или настроены retries (`retryCount`/`maxRetries`)
- Если нет информации о retries — показывается только иконка без label
- Кнопка disabled при статусе `pending` или `processing`
- При клике вызывает `onRetry(job)` с `stopPropagation()` (не триггерит `onClick` карточки)

### PipelineViewer с retry

`PipelineViewer` прокидывает `onJobRetry` в каждую `JobNode`:

```tsx
<PipelineViewer
    pipeline={pipeline}
    onJobClick={(job) => showDetails(job)}
    onJobRetry={(job) => restartPipeline(job.name)}  // прокидывается в JobNode.onRetry
    selectedJobName={selectedJob?.name}
/>
```

### Storybook

Каждый компонент имеет `.stories.tsx`:

```tsx
// JobNode.stories.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { JobNode } from './JobNode';

const meta: Meta<typeof JobNode> = {
    component: JobNode,
    title: 'Components/JobNode',
};

export default meta;
type Story = StoryObj<typeof JobNode>;

export const Default: Story = {
    args: { ... },
};
```

## Стилизация

- Используй MUI `sx` prop для инлайн стилей
- Цвета статусов из `theme.ts`
- Респонсивность через MUI breakpoints

## Правила

1. **Все компоненты экспортируются** из `index.ts`
2. **Stories обязательны** для каждого компонента
3. **Props типизированы** через interface
4. **Без внешнего состояния** — компоненты controlled
5. **Тексты интерфейса** в компонентах — на английском (например, Error, Artefact)
